#include "arm1.h"



int main()
{
    init_platform();
    sleep(1);

    // Disable cache on OCM
	// S=b1 TEX=b100 AP=b11, Domain=b1111, C=b0, B=b0
	Xil_SetTlbAttributes(0xFFFF0000,0x14de2);

	while(1){
		while(COMM_VAL == 0){
			// wait for ARM0
		}

		for(;;) {
			for(int i=0;i<filesNum;++i) {
				printf("%c%s\r\n",i==currentFile ? '*' : ' ',files[i]);
			}
			printf("UP    : Previous file\r\n");
			printf("DOWN  : Next file\r\n");
			print("P: Play\r\n");
			print("S: Stop\r\n");
			print("X: Exit \r\n\n\n");

			int c = getchar();

			if(c == 120){	// x
				stopWavFile();
				exit_flag = 1;
				break;
			}

			switch(c){
				case 112:	// p
					playWavFile(files[currentFile]);
					break;

				case 115:	// s
					stopWavFile();
					break;

				case 0x5B:	// down arrow
					c = getchar();
					if (c==0x42) {
						if (currentFile+1<filesNum) {
							++currentFile;
						}
					}
					else if (c==0x41) {		// up arrow
						if (currentFile>0) {
							--currentFile;
						}
					}
			}
		}
		COMM_VAL = 0;

	}


}


